<%@ Page Title="" Language="C#" MasterPageFile="~/admin.Master" AutoEventWireup="true" CodeBehind="qr.aspx.cs" Inherits="QrMgr.qr" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <style type="text/css">
        .auto-style4 {
            height: 50px;
        }
        .auto-style5 {
            height: 80px;
        }
        .auto-style6 {
            height: 56px;
        }
    </style>
</asp:Content>
<asp:Content ID="Content5" runat="server" contentplaceholderid="ContentPlaceHolder2">
                        <div style="height: 68px">
                        </div>
                    </asp:Content>
<asp:Content ID="Content6" runat="server" contentplaceholderid="ContentPlaceHolder3">
                        <div style="height: 451px">
                            <asp:MultiView ID="MultiView1" runat="server">
                                <asp:View ID="add" runat="server">
                                    <asp:Label ID="Label_boot" runat="server" Width="40%"></asp:Label>
                                    <table style="width:100%;">
                                        <tr>
                                            <td class="auto-style4">
                                                <asp:Label ID="Label1" runat="server" Text="地址(可选)"></asp:Label>
                                            </td>
                                            <td class="auto-style4">
                                                <asp:TextBox ID="TextBox1" runat="server" Height="20px" Width="166px"></asp:TextBox>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="auto-style5">
                                                <asp:Label ID="Label2" runat="server" Text="备注"></asp:Label>
                                            </td>
                                            <td class="auto-style5">
                                                <asp:TextBox ID="TextBox2" runat="server" Height="55px" TextMode="MultiLine" Width="177px"></asp:TextBox>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>
                                                <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="新建" />
                                            </td>
                                        </tr>
                                    </table>
                                </asp:View>
                                <asp:View ID="edit" runat="server">
                                    <asp:Label ID="Label_boot_edit" runat="server"></asp:Label>
                                    <asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" AutoGenerateDeleteButton="True" AutoGenerateSelectButton="True" DataKeyNames="qrId" DataSourceID="SqlDataSource1" Height="128px" OnRowCreated="GridView1_RowCreated" OnRowDataBound="GridView1_RowDataBound" Width="737px" AllowPaging="True" OnRowDeleting="GridView1_RowDeleting">
                                        <Columns>
                                            <asp:BoundField DataField="Url" HeaderText="地址" SortExpression="Url" />
                                            <asp:BoundField DataField="备注" HeaderText="备注" SortExpression="备注" />
                                            <asp:BoundField DataField="uploadId" HeaderText="关联资源id" SortExpression="uploadId" />
                                            <asp:BoundField DataField="生成时间" HeaderText="生成时间" SortExpression="生成时间" />
                                            <asp:BoundField DataField="qrId" HeaderText="二维码id" ReadOnly="True" SortExpression="qrId" />
                                            <asp:ImageField DataImageUrlField="Url" DataImageUrlFormatString="genqr.aspx?url={0}" HeaderText="二维码图片" ReadOnly="True">
                                                <ItemStyle Height="90px" Width="90px" />
                                            </asp:ImageField>
                                        </Columns>
                                        <SelectedRowStyle BackColor="#CCCCCC" />
                                    </asp:GridView>
                                    <asp:SqlDataSource ID="SqlDataSource1" runat="server" ConnectionString="<%$ ConnectionStrings:qrmgrConnectionString %>" DeleteCommand="DELETE FROM [qrcode] WHERE [qrId] = @qrId" InsertCommand="INSERT INTO [qrcode] ([Url], [备注], [uploadId], [生成时间]) VALUES (@Url, @备注, @uploadId, @生成时间)" SelectCommand="SELECT [Url], [备注], [uploadId], [生成时间], [qrId] FROM [qrcode]" UpdateCommand="UPDATE [qrcode] SET [Url] = @Url, [备注] = @备注, [uploadId] = @uploadId, [生成时间] = @生成时间 WHERE [qrId] = @qrId">
                                        <DeleteParameters>
                                            <asp:Parameter Name="qrId" Type="Int32" />
                                        </DeleteParameters>
                                        <InsertParameters>
                                            <asp:Parameter Name="Url" Type="String" />
                                            <asp:Parameter Name="备注" Type="String" />
                                            <asp:Parameter Name="uploadId" Type="Int32" />
                                            <asp:Parameter Name="生成时间" Type="DateTime" />
                                        </InsertParameters>
                                        <UpdateParameters>
                                            <asp:Parameter Name="Url" Type="String" />
                                            <asp:Parameter Name="备注" Type="String" />
                                            <asp:Parameter Name="uploadId" Type="Int32" />
                                            <asp:Parameter Name="生成时间" Type="DateTime" />
                                            <asp:Parameter Name="qrId" Type="Int32" />
                                        </UpdateParameters>
                                    </asp:SqlDataSource>
                                    <table style="width:100%;">
                                        <tr>
                                            <td class="auto-style6"></td>
                                            <td class="auto-style6">
                                                <asp:Button ID="Button2" runat="server" Height="27px" OnClick="Button2_Click" Text="关联" Width="69px" />
                                                <asp:Button ID="Button3" runat="server" OnClick="Button3_Click" Text="解除关联" />
                                            </td>
                                            <td class="auto-style6"></td>
                                        </tr>
                                    </table>
                                    <asp:GridView ID="GridView2" runat="server" AutoGenerateColumns="False" AutoGenerateSelectButton="True" DataKeyNames="uploadId" DataSourceID="SqlDataSource2" Width="737px" AllowPaging="True">
                                        <Columns>
                                            <asp:BoundField DataField="类型" HeaderText="类型" SortExpression="类型" />
                                            <asp:BoundField DataField="uploadId" HeaderText="资源id" InsertVisible="False" ReadOnly="True" SortExpression="uploadId" />
                                            <asp:BoundField DataField="备注" HeaderText="备注" SortExpression="备注" />
                                        </Columns>
                                        <SelectedRowStyle BackColor="#CCCCCC" />
                                    </asp:GridView>
                                    <asp:SqlDataSource ID="SqlDataSource2" runat="server" ConnectionString="<%$ ConnectionStrings:qrmgrConnectionString %>" SelectCommand="SELECT [类型], [uploadId], [备注] FROM [upload]"></asp:SqlDataSource>
                                </asp:View>
                            </asp:MultiView>
                        </div>
                    </asp:Content>
<asp:Content ID="Content7" runat="server" contentplaceholderid="ContentPlaceHolder4">
                        <div style="height: 449px; width: 153px">
                            <asp:TreeView ID="TreeView1" runat="server">
    <Nodes>
        <asp:TreeNode Text="教材管理" Value="index" Expanded="False" NavigateUrl="book.aspx">
            <asp:TreeNode Text="添加教材" Value="add" NavigateUrl="book.aspx?action=add"></asp:TreeNode>
            <asp:TreeNode Text="编辑教材" Value="edit" NavigateUrl="book.aspx?action=edit"></asp:TreeNode>
        </asp:TreeNode>
        <asp:TreeNode Text="知识点管理" Value="新建节点" Expanded="False" NavigateUrl="point.aspx">
            <asp:TreeNode Text="添加知识点" Value="添加知识点" NavigateUrl="point.aspx?action=add"></asp:TreeNode>
            <asp:TreeNode Text="编辑知识点" Value="编辑知识点" NavigateUrl="point.aspx?action=edit"></asp:TreeNode>
        </asp:TreeNode>
        <asp:TreeNode Text="资源管理" Value="新建节点" Expanded="False" NavigateUrl="upload.aspx">
            <asp:TreeNode Text="添加资源" Value="添加资源" NavigateUrl="upload.aspx?action=add"></asp:TreeNode>
            <asp:TreeNode Text="编辑资源" Value="编辑资源" NavigateUrl="upload.aspx?action=edit"></asp:TreeNode>
        </asp:TreeNode>
        <asp:TreeNode Text="二维码管理" Value="新建节点" Expanded="True" NavigateUrl="qr.aspx">
            <asp:TreeNode Text="添加二维码" Value="添加二维码" NavigateUrl="qr.aspx?action=add"></asp:TreeNode>
            <asp:TreeNode Text="编辑资源" Value="编辑资源" NavigateUrl="qr.aspx?action=edit"></asp:TreeNode>
        </asp:TreeNode>
        <asp:TreeNode Text="用户管理" Value="用户管理" Expanded="False" NavigateUrl="useradmin.aspx">
            <asp:TreeNode Text="添加用户" Value="添加用户" NavigateUrl="useradmin.aspx?action=add"></asp:TreeNode>
            <asp:TreeNode Text="修改密码" Value="编辑用户" NavigateUrl="useradmin.aspx?action=edit&username=" ></asp:TreeNode>
        </asp:TreeNode>
        <asp:TreeNode Text="向导" Value="向导" NavigateUrl="guide.aspx"></asp:TreeNode>
    </Nodes>
                                <SelectedNodeStyle BackColor="#CCCCCC" />
</asp:TreeView>
                        </div>
                    </asp:Content>

